<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Carl's Jr Mobile - TK Inventory</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&display=swap');
        
        * {
            font-family: 'Nunito', sans-serif;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            /* Full Black Background */
            background: #000000;
            overflow-x: hidden;
            color: #ffffff;
        }
        
        .mobile-card {
            /* Dark Charcoal Card Background */
            background: #292929;
            border-radius: 24px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4); 
        }
        
        .bottom-nav {
            /* Black Nav Background */
            background: #000000;
            box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.6);
            border-radius: 24px 24px 0 0;
        }
        
        .fab-button {
            /* Solid Green FAB */
            background: #169611; 
            box-shadow: 0 8px 20px rgba(22, 150, 17, 0.6);
            transition: all 0.3s ease;
        }
        
        .fab-button:active {
            transform: scale(0.95);
        }
        
        .nav-item-active {
            /* Active tab accent color */
            color: #e62e2d; 
            background: rgba(230, 46, 45, 0.1);
        }
        
        .status-badge-new {
            /* Active status gradient */
            background: linear-gradient(135deg, #12af5a 0%, #0a7f43 100%);
        }
        
        .status-badge-old {
            /* Expired status gradient */
            background: linear-gradient(135deg, #b87801 0%, #d97706 100%);
        }
        
        .slide-up {
            animation: slideUp 0.3s ease-out;
        }
        
        @keyframes slideUp {
            from {
                transform: translateY(100%);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
        
        .fade-in {
            animation: fadeIn 0.3s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .bounce-in {
            animation: bounceIn 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }
        
        @keyframes bounceIn {
            0% {
                transform: scale(0.3);
                opacity: 0;
            }
            50% {
                transform: scale(1.05);
            }
            100% {
                transform: scale(1);
                opacity: 1;
            }
        }
        
        .swipe-delete {
            transition: transform 0.3s ease;
        }
        
        .header-gradient {
            /* Header gradient */
            background: linear-gradient(135deg, #1d1c1c 0%, #000000 100%);
        }
        
        input:focus, select:focus {
            outline: none;
            border-color: #a31717;
            box-shadow: 0 0 0 3px rgba(12, 3, 3, 0.3);
        }
        
        .empty-state {
            opacity: 0.6;
            color: #888888; 
        }
        
        .logo-icon {
            /* Custom styling for the logo */
            background: #ffb900;
            border-radius: 50%; 
            position: relative;
        }
        .logo-icon:before {
            content: '‚òÖ'; 
            color: #e62e2d;
            font-size: 20px;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }
    </style>
</head>
<body class="pb-24">
    
    <header class="header-gradient p-6 pb-8 sticky top-0 z-30">
        <div class="flex items-center justify-between mb-6">
            <div class="flex items-center space-x-3">
                <div class="w-12 h-12 bg-black/40 backdrop-blur rounded-2xl flex items-center justify-center">
                    <img src="https://www.carlsjr.com/images/star-ft.png" alt="">
                </div>
                <div>
                    <h1 class="text-2xl font-bold text-yellow-400">Carl's Jr</h1>
                    <p class="text-white/80 text-sm">Cambodai TK</p>
                </div>
            </div>
            <button class="w-10 h-10 bg-black/40 backdrop-blur rounded-xl flex items-center justify-center">
                <svg class="w-6 h-6 text-yellow-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 5v.01M12 12v.01M12 19v.01M12 6a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z"/>
                </svg>
            </button>
        </div>
        
        <div class="grid grid-cols-3 gap-3">
            <div class="bg-black/40 backdrop-blur rounded-2xl p-4 text-center">
                <p class="text-white/70 text-xs mb-1">Total</p>
                <p id="stat-total" class="text-2xl font-bold text-white">0</p>
            </div>
            <div class="bg-black/40 backdrop-blur rounded-2xl p-4 text-center">
                <p class="text-white/70 text-xs mb-1">Active</p>
                <p id="stat-active" class="text-2xl font-bold text-white">0</p>
            </div>
            <div class="bg-black/40 backdrop-blur rounded-2xl p-4 text-center">
                <p class="text-white/70 text-xs mb-1">Expired</p>
                <p id="stat-expired" class="text-2xl font-bold text-white">0</p>
            </div>
        </div>
    </header>
    
    <main class="px-4 pt-4 pb-6">
        
        <div id="content-oil" class="content-section">
            <div class="flex items-center justify-between mb-4">
                <h2 class="text-xl font-bold text-white">Cooking Oil</h2>
                <span id="oil-count" class="px-3 py-1 bg-white/20 backdrop-blur rounded-full text-white text-sm font-bold">0</span>
            </div>
            <div id="oil-list" class="space-y-3">
                </div>
        </div>
        
        <div id="content-soap" class="content-section hidden">
            <div class="flex items-center justify-between mb-4">
                <h2 class="text-xl font-bold text-white">Cleaning Soap</h2>
                <span id="soap-count" class="px-3 py-1 bg-white/20 backdrop-blur rounded-full text-white text-sm font-bold">0</span>
            </div>
            <div id="soap-list" class="space-y-3">
                </div>
        </div>
    </main>
    
    <button id="fab" class="fab-button fixed bottom-28 right-6 w-16 h-16 rounded-full flex items-center justify-center z-20 bounce-in">
        <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M12 4v16m8-8H4"/>
        </svg>
    </button>
    
    <nav class="bottom-nav fixed bottom-0 left-0 right-0 z-30">
        <div class="flex items-center justify-around p-4">
            <button id="nav-oil" class="nav-item nav-item-active flex-1 py-3 px-4 rounded-2xl flex flex-col items-center space-y-1 transition text-white">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19.428 15.428a2 2 0 00-1.022-.547l-2.387-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z"/>
                </svg>
                <span class="text-xs font-bold">Oil</span>
            </button>
            <button id="nav-soap" class="nav-item flex-1 py-3 px-4 rounded-2xl flex flex-col items-center space-y-1 transition text-gray-500">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"/>
                </svg>
                <span class="text-xs font-bold">Soap</span>
            </button>
        </div>
    </nav>
    
    <div id="add-modal" class="fixed inset-0 bg-black/80 backdrop-blur-sm hidden items-center justify-end flex-col z-40 fade-in">
        <div class="mobile-card w-full rounded-b-none slide-up">
            <div class="p-6 border-b border-gray-700">
                <div class="flex items-center justify-between mb-2">
                    <h3 class="text-2xl font-bold text-white">New Entry</h3>
                    <button id="close-add-modal" class="w-10 h-10 bg-gray-700 rounded-xl flex items-center justify-center">
                        <svg class="w-6 h-6 text-white/70" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M6 18L18 6M6 6l12 12"/>
                        </svg>
                    </button>
                </div>
                <p class="text-gray-400 text-sm">Add inventory details</p>
            </div>
            
            <form id="entry-form" class="p-6">
                <div class="mb-5">
                    <label class="block text-sm font-bold text-white/80 mb-2">Day</label>
                    <div id="day-buttons-container" class="grid grid-cols-4 gap-2">
                        <button type="button" class="day-select-btn bg-gray-700 text-white/80 rounded-xl py-2 px-1 text-xs transition duration-150 ease-in-out hover:bg-gray-600" data-day="Monday">Mon</button>
                        <button type="button" class="day-select-btn bg-gray-700 text-white/80 rounded-xl py-2 px-1 text-xs transition duration-150 ease-in-out hover:bg-gray-600" data-day="Tuesday">Tue</button>
                        <button type="button" class="day-select-btn bg-gray-700 text-white/80 rounded-xl py-2 px-1 text-xs transition duration-150 ease-in-out hover:bg-gray-600" data-day="Wednesday">Wed</button>
                        <button type="button" class="day-select-btn bg-gray-700 text-white/80 rounded-xl py-2 px-1 text-xs transition duration-150 ease-in-out hover:bg-gray-600" data-day="Thursday">Thu</button>
                        <button type="button" class="day-select-btn bg-gray-700 text-white/80 rounded-xl py-2 px-1 text-xs transition duration-150 ease-in-out hover:bg-gray-600" data-day="Friday">Fri</button>
                        <button type="button" class="day-select-btn bg-gray-700 text-white/80 rounded-xl py-2 px-1 text-xs transition duration-150 ease-in-out hover:bg-gray-600" data-day="Saturday">Sat</button>
                        <button type="button" class="day-select-btn bg-gray-700 text-white/80 rounded-xl py-2 px-1 text-xs transition duration-150 ease-in-out hover:bg-gray-600" data-day="Sunday">Sun</button>
                        <button type="button" class="day-select-btn bg-gray-700 text-white/80 rounded-xl py-2 px-1 text-xs transition duration-150 ease-in-out hover:bg-gray-600" data-day="">Clear</button>
                    </div>
                    <input type="hidden" id="day-input" value="">
                </div>
                
                <div class="mb-6">
                    <label class="block text-sm font-bold text-white/80 mb-2">Date</label>
                    <input type="date" id="date-input" class="w-full px-4 py-4 border-2 border-gray-700 bg-black rounded-2xl text-base transition text-white">
                </div>
                
                <div class="flex space-x-3">
                    <button type="button" id="cancel-btn" class="flex-1 py-4 bg-gray-700 text-white/80 rounded-2xl font-bold text-base">
                        Cancel
                    </button>
                    <button type="submit" class="flex-1 py-4 header-gradient text-white rounded-2xl font-bold text-base">
                        Save
                    </button>
                </div>
            </form>
        </div>
    </div>

    <div id="msg-modal" class="fixed inset-0 bg-black/80 backdrop-blur-sm hidden items-center justify-center z-50 fade-in">
        <div class="mobile-card p-6 w-11/12 max-w-sm bounce-in text-center">
            <h4 id="msg-title" class="text-xl font-bold mb-3 text-yellow-400"></h4>
            <p id="msg-content" class="text-gray-300 mb-6"></p>
            <button id="msg-close-btn" class="w-full py-3 bg-gray-700 text-white rounded-xl font-bold">
                Close
            </button>
        </div>
    </div>

    <div id="confirm-modal" class="fixed inset-0 bg-black/80 backdrop-blur-sm hidden items-center justify-center z-50 fade-in">
        <div class="mobile-card p-6 w-11/12 max-w-sm bounce-in text-center">
            <h4 class="text-xl font-bold mb-3 text-red-500">Confirm Deletion</h4>
            <p id="confirm-content" class="text-gray-300 mb-6">Are you sure you want to delete this entry? This action cannot be undone.</p>
            <div class="flex space-x-3">
                <button id="confirm-cancel-btn" class="flex-1 py-3 bg-gray-700 text-white rounded-xl font-bold">
                    Cancel
                </button>
                <button id="confirm-ok-btn" class="flex-1 py-3 bg-red-700 text-white rounded-xl font-bold">
                    Delete
                </button>
            </div>
        </div>
    </div>


    <script>
        const API_BASE_URL = 'https://carl-s-jr-tk-backend.onrender.com/api/inventory/';
        let currentProduct = 'oil';

        // Add Entry Modal Elements
        const addModal = document.getElementById('add-modal');
        const fab = document.getElementById('fab');
        const closeAddModalBtn = document.getElementById('close-add-modal');
        const cancelBtn = document.getElementById('cancel-btn');
        const entryForm = document.getElementById('entry-form');
        
        // Modal Inputs
        const dayInput = document.getElementById('day-input'); 
        const dayButtonsContainer = document.getElementById('day-buttons-container');
        const dateInput = document.getElementById('date-input');
        
        // Custom Modal Elements
        const msgModal = document.getElementById('msg-modal');
        const msgTitle = document.getElementById('msg-title');
        const msgContent = document.getElementById('msg-content');
        const msgCloseBtn = document.getElementById('msg-close-btn');

        const confirmModal = document.getElementById('confirm-modal');
        const confirmOkBtn = document.getElementById('confirm-ok-btn');
        const confirmCancelBtn = document.getElementById('confirm-cancel-btn');
        let pendingDeleteAction = null; 

        // Navigation and Content Elements
        const navOil = document.getElementById('nav-oil');
        const navSoap = document.getElementById('nav-soap');
        const contentOil = document.getElementById('content-oil');
        const contentSoap = document.getElementById('content-soap');
        
        const oilList = document.getElementById('oil-list');
        const soapList = document.getElementById('soap-list');
        const oilCount = document.getElementById('oil-count');
        const soapCount = document.getElementById('soap-count');


        // --- Custom Dialog Functions ---

        function showMessage(title, content) {
            msgTitle.textContent = title;
            msgContent.textContent = content;
            msgModal.classList.remove('hidden');
            msgModal.classList.add('flex');
            document.body.style.overflow = 'hidden';
        }

        function hideMessage() {
            msgModal.classList.add('hidden');
            msgModal.classList.remove('flex');
            document.body.style.overflow = '';
        }

        function showConfirm(actionFunction) {
            pendingDeleteAction = actionFunction;
            confirmModal.classList.remove('hidden');
            confirmModal.classList.add('flex');
            document.body.style.overflow = 'hidden';
        }

        function hideConfirm() {
            pendingDeleteAction = null;
            confirmModal.classList.add('hidden');
            confirmModal.classList.remove('flex');
            document.body.style.overflow = '';
        }

        // --- Add Entry Modal Logic ---

        function showAddModal() {
            addModal.classList.remove('hidden');
            addModal.classList.add('flex');
            document.body.style.overflow = 'hidden';
        }

        function hideAddModal() {
            addModal.classList.add('hidden');
            addModal.classList.remove('flex');
            entryForm.reset();
            
            // Reset the custom day input and button styles
            dayInput.value = ''; 
            document.querySelectorAll('.day-select-btn').forEach(btn => {
                btn.classList.remove('bg-red-700', 'text-white', 'font-bold');
                btn.classList.add('bg-gray-700', 'text-white/80');
            });
            
            document.body.style.overflow = '';
        }
        
        // Function to handle day button selection
        function handleDaySelection(selectedDay, buttonElement) {
            // 1. Clear active state from all buttons
            document.querySelectorAll('.day-select-btn').forEach(btn => {
                btn.classList.remove('bg-red-700', 'text-white', 'font-bold');
                btn.classList.add('bg-gray-700', 'text-white/80');
            });

            // 2. Set active state on the clicked button (unless it's the "Clear" button with data-day="")
            if (selectedDay) {
                buttonElement.classList.add('bg-red-700', 'text-white', 'font-bold');
                buttonElement.classList.remove('bg-gray-700', 'text-white/80');
            }

            // 3. Update the hidden input field value
            dayInput.value = selectedDay;
        }

        // --- Core App Logic ---

        function switchTab(product) {
            currentProduct = product;
            
            // Reset colors
            navOil.classList.remove('nav-item-active', 'text-white');
            navOil.classList.add('text-gray-500');
            navSoap.classList.remove('nav-item-active', 'text-white');
            navSoap.classList.add('text-gray-500');

            if (product === 'oil') {
                navOil.classList.add('nav-item-active', 'text-white');
                navOil.classList.remove('text-gray-500');
                contentOil.classList.remove('hidden');
                contentSoap.classList.add('hidden');
            } else {
                navSoap.classList.add('nav-item-active', 'text-white');
                navSoap.classList.remove('text-gray-500');
                contentSoap.classList.remove('hidden');
                contentOil.classList.add('hidden');
            }
            // Fetch and render data for the new tab
            fetchAndRender(currentProduct);
        }

        async function fetchAllData() {
            const oil = await fetchEntries('oil');
            const soap = await fetchEntries('soap');
            return { oil, soap };
        }

        async function fetchEntries(product) {
            try {
                const response = await fetch(API_BASE_URL + product);
                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                return await response.json();
            } catch (error) {
                console.error(`Could not fetch ${product} entries:`, error);
                return [];
            }
        }

        async function updateStats() {
            const { oil, soap } = await fetchAllData();
            
            const total = oil.length + soap.length;
            // Ensure status property exists before filtering
            const allEntries = [...oil, ...soap].filter(item => item.status); 
            const active = allEntries.filter(item => item.status === 'New Use').length;
            const expired = allEntries.filter(item => item.status === 'Old EXP').length;
            
            document.getElementById('stat-total').textContent = total;
            document.getElementById('stat-active').textContent = active;
            document.getElementById('stat-expired').textContent = expired;
            oilCount.textContent = oil.length;
            soapCount.textContent = soap.length;
        }
        
        // üö® MODIFIED: Sort Oldest-First, then Reverse (Newest at Index 0)
        async function fetchAndRender(product) {
            const items = await fetchEntries(product);
            
            // 1. Sort items by date from OLDEST to NEWEST
            let sortedItems = items.sort((a, b) => {
                const dateA = new Date(a.date);
                const dateB = new Date(b.date);
                return dateA - dateB; 
            });
            
            // 2. Reverse the array: NEWEST is now at index 0 (will be displayed at the top)
            sortedItems.reverse(); 

            renderList(product, sortedItems);
            await updateStats();
        }

        // üö® MODIFIED: Custom Numbering (Total - Index)
        function renderList(product, items) {
            const list = product === 'oil' ? oilList : soapList;
            const totalItems = items.length; // ·ûô·ûÄ·ûÖ·üÜ·ûì·ûΩ·ûì·ûí·û∂·ûè·ûª·ûü·ûö·ûª·ûî
            
            if (totalItems === 0) {
                list.innerHTML = `
                    <div class="mobile-card p-8 text-center empty-state">
                        <svg class="w-16 h-16 mx-auto mb-3 text-gray-700" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4"/>
                        </svg>
                        <p class="text-gray-500 font-semibold">No entries yet</p>
                        <p class="text-gray-500 text-sm">Tap + to add</p>
                    </div>
                `;
                return;
            }
            
            // Numbering Logic: Total Items - Current Index
            // Index 0 (Newest/Top) gets Total number.
            // Last Index (Oldest/Bottom) gets #1.
            list.innerHTML = items.map((item, index) => {
                const customNumber = totalItems - index;

                return `
                    <div class="mobile-card p-4 fade-in">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center space-x-4 flex-1">
                                <div class="w-12 h-12 ${item.status === 'New Use' ? 'status-badge-new' : 'status-badge-old'} rounded-2xl flex items-center justify-center">
                                    <span class="text-white font-bold text-lg">${customNumber}</span> 
                                </div>
                                <div class="flex-1">
                                    <h4 class="font-bold text-white text-base">${item.day}</h4>
                                    <p class="text-sm text-gray-400">${item.date}</p>
                                </div>
                            </div>
                            <div class="flex items-center space-x-2">
                                <span class="px-3 py-1.5 ${item.status === 'New Use' ? 'bg-green-600/20 text-green-300' : 'bg-amber-600/20 text-amber-300'} rounded-xl text-xs font-bold">
                                    ${item.status === 'New Use' ? 'USE' : 'Expired'}
                                </span>
                                <button onclick="handleDelete('${product}', '${item._id}')" class="w-10 h-10 bg-red-800/20 rounded-xl flex items-center justify-center">
                                    <svg class="w-5 h-5 text-red-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
                                    </svg>
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        window.handleDelete = function(product, id) {
            const deleteAction = async () => {
                hideConfirm();
                try {
                    const response = await fetch(`${API_BASE_URL}${product}/${id}`, {
                        method: 'DELETE',
                    });
                    
                    if (response.ok) {
                        showMessage("Success", "Entry deleted successfully.");
                        fetchAndRender(product);
                    } else {
                        const errorData = await response.json();
                        showMessage("Error", `Failed to delete entry: ${errorData.error || 'Server error.'}`);
                    }
                } catch (error) {
                    console.error('Error deleting entry:', error);
                    showMessage("Network Error", 'Network error while deleting entry.');
                }
            };
            
            showConfirm(deleteAction);
        };

        // --- BATCH INSERTION UTILITY (For quick testing/loading data) ---
        window.insertHardcodedOilData = async function() {
            const inventoryData = [
                { day: "Saturday", date: "2025-11-30" }, 
                { day: "Saturday", date: "2025-11-30" }, 
                { day: "Saturday", date: "2025-11-29" }, 
                { day: "Friday", date: "2025-11-22" },   
                { day: "Friday", date: "2025-11-22" },   
                { day: "Saturday", date: "2025-11-17" }, 
                { day: "Saturday", date: "2025-11-07" }  
            ];
            
            const product = 'oil';
            let successCount = 0;
            let failCount = 0;
            
            showMessage("Loading Data...", `Inserting ${inventoryData.length} entries for Cooking Oil. Please wait.`);

            for (const [index, entry] of inventoryData.entries()) {
                try {
                    const payload = { day: entry.day, date: entry.date };
                    
                    const response = await fetch(API_BASE_URL + product, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    if (response.ok) {
                        successCount++;
                    } else {
                        failCount++;
                    }
                } catch (error) {
                    failCount++;
                }
            }

            hideMessage();
            if (successCount > 0) {
                // Switch to Oil tab and refresh view
                switchTab('oil'); 
                showMessage("Insertion Complete", `Successfully added ${successCount} Oil entries.`);
            } else if (failCount > 0) {
                showMessage("Insertion Failed", `Could not add entries. Check your API server.`);
            } else {
                 showMessage("No Data Added", "No entries were successfully added.");
            }
        };


        // --- Event Listeners ---
        
        navOil.addEventListener('click', () => switchTab('oil'));
        navSoap.addEventListener('click', () => switchTab('soap'));
        
        fab.addEventListener('click', showAddModal);
        closeAddModalBtn.addEventListener('click', hideAddModal);
        cancelBtn.addEventListener('click', hideAddModal);

        addModal.addEventListener('click', (e) => {
            if (e.target === addModal) hideAddModal();
        });
        
        // Event listener for Day Buttons using delegation
        dayButtonsContainer.addEventListener('click', (e) => {
            const button = e.target.closest('.day-select-btn');
            if (button) {
                const selectedDay = button.getAttribute('data-day');
                handleDaySelection(selectedDay, button);
            }
        });

        // Message Modal Listeners
        msgCloseBtn.addEventListener('click', hideMessage);
        msgModal.addEventListener('click', (e) => {
            if (e.target === msgModal) hideMessage();
        });

        // Confirmation Modal Listeners
        confirmCancelBtn.addEventListener('click', hideConfirm);
        confirmOkBtn.addEventListener('click', () => {
            if (pendingDeleteAction) {
                pendingDeleteAction(); // Execute the pending delete function
            }
        });
        confirmModal.addEventListener('click', (e) => {
            if (e.target === confirmModal) hideConfirm();
        });


        entryForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            // Reading the value from the hidden input, set by the buttons
            const day = dayInput.value.trim(); 
            const date = dateInput.value.trim();
            
            if (!day || !date) {
                showMessage("Input Required", 'Please select a day and enter a date.');
                return;
            }
            
            const newEntry = { day, date };
            
            try {
                const response = await fetch(API_BASE_URL + currentProduct, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(newEntry)
                });

                if (response.ok) {
                    hideAddModal();
                    fetchAndRender(currentProduct);
                } else {
                    const errorData = await response.json();
                    showMessage("Error", `Failed to save entry. Server response: ${errorData.error || 'Unknown error.'}`);
                }
            } catch (error) {
                console.error('Error saving entry:', error);
                showMessage("Network Error", 'Network error while saving entry. Check if Flask API is running.');
            }
        });

        // Initialize state on load
        switchTab('oil');
    </script>
</body>
</html>